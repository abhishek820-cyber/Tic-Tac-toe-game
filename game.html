<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Game</title>
  <link rel="stylesheet" href="game.css" />
</head>
<body class="game-body x-turn">

  <div class="game-container">
    <div class="scoreboard">
      <span id="xScore">X: 0</span> | <span id="oScore">O: 0</span>
    </div>

    <p id="status">Player X's turn</p>

    <div class="board-wrapper"> 
      <div class="grid" id="board"> 
        <div class="cell" data-index="0"></div>
        <div class="cell" data-index="1"></div>
        <div class="cell" data-index="2"></div>
        <div class="cell" data-index="3"></div>
        <div class="cell" data-index="4"></div>
        <div class="cell" data-index="5"></div>
        <div class="cell" data-index="6"></div>
        <div class="cell" data-index="7"></div>
        <div class="cell" data-index="8"></div>
      </div>
      <div class="strike-line" id="strike"></div>
    </div>

    <button id="reset-btn" class="glow-btn">Restart</button>
    <button id="home-btn" class="glow-btn" style="margin-top: 5px;">Back to Menu</button>
  </div>

  <script>
    const cells = document.querySelectorAll(".cell");
    const status = document.getElementById("status");
    const resetBtn = document.getElementById("reset-btn");
    const homeBtn = document.getElementById("home-btn");
    const xScoreEl = document.getElementById("xScore");
    const oScoreEl = document.getElementById("oScore");
    const strike = document.getElementById("strike");

    let board = Array(9).fill("");
    let currentPlayer = "X";
    let gameActive = true;
    let scores = { X: 0, O: 0 };
    const params = new URLSearchParams(window.location.search);
    const mode = params.get("mode");

    function updateBackground() {
      document.body.classList.remove("x-turn", "o-turn", "turn-pulse");
      void document.body.offsetWidth; // reflow to replay animation
      document.body.classList.add(currentPlayer === "X" ? "x-turn" : "o-turn");
      document.body.classList.add("turn-pulse");
    }

    cells.forEach(cell => {
      cell.addEventListener("click", () => handleClick(cell));
    });

    function handleClick(cell) {
      const idx = cell.dataset.index;
      if (!gameActive || board[idx] !== "") return;

      board[idx] = currentPlayer;
      cell.textContent = currentPlayer;
      cell.style.color = currentPlayer === "X" ? "#ff00aa" : "#00ffff"; 
      cell.style.textShadow = `0 0 15px ${currentPlayer === "X" ? "#ff00aa" : "#00ffff"}`;

      const winPattern = checkWin();
      if (winPattern) {
        scores[currentPlayer]++;
        updateScores();
        status.textContent = `ðŸŽ‰ Player ${currentPlayer} wins!`;
        gameActive = false;
        drawStrike(winPattern);
        return;
      }

      if (board.every(cell => cell !== "")) {
        status.textContent = "It's a draw!";
        gameActive = false;
        return;
      }

      currentPlayer = currentPlayer === "X" ? "O" : "X";
      status.textContent = `Player ${currentPlayer}'s turn`;
      updateBackground();

      if (mode === "ai" && currentPlayer === "O" && gameActive) {
        setTimeout(aiMove, 400);
      }
    }

    function aiMove() {
      const available = board.map((v, i) => v === "" ? i : null).filter(v => v !== null);
      const move = available[Math.floor(Math.random() * available.length)];
      const cell = cells[move];
      handleClick(cell);
    }

    function checkWin() {
      const patterns = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (const p of patterns) {
        const [a,b,c] = p;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) return p;
      }
      return null;
    }

    function updateScores() {
      xScoreEl.textContent = `X: ${scores.X}`;
      oScoreEl.textContent = `O: ${scores.O}`;
    }

    function drawStrike(pattern) {
      const positions = [
        { top: 60, left: 190, angle: 0, length: 380 },
        { top: 190, left: 190, angle: 0, length: 380 },
        { top: 320, left: 190, angle: 0, length: 380 },
        { top: 190, left: 60, angle: 90, length: 380 },
        { top: 190, left: 190, angle: 90, length: 380 },
        { top: 190, left: 320, angle: 90, length: 380 },
        { top: 190, left: 190, angle: 45, length: 537 },
        { top: 190, left: 190, angle: -45, length: 537 },
      ];
      const idx = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ].findIndex(p => p.toString() === pattern.toString());
      const pos = positions[idx];
      strike.style.top = `${pos.top}px`;
      strike.style.left = `${pos.left}px`;
      strike.style.transform = `translate(-50%, -50%) rotate(${pos.angle}deg)`;
      strike.style.width = `${pos.length}px`;
      strike.style.opacity = "1";
      strike.style.background = currentPlayer === "X" ? "#ff00aa" : "#00ffff";
      strike.style.boxShadow = `0 0 20px ${currentPlayer === "X" ? "#ff00aa" : "#00ffff"}`;
    }

    resetBtn.addEventListener("click", () => {
      board.fill("");
      cells.forEach(c => {
        c.textContent = "";
        c.style.textShadow = "";
        c.style.color = "";
      });
      currentPlayer = "X";
      gameActive = true;
      status.textContent = `Player X's turn`;
      strike.style.opacity = "0";
      strike.style.width = "0";
      updateBackground();
    });

    homeBtn.addEventListener("click", () => {
      window.location.href = "index.html";
    });

    updateBackground();
  </script>
</body>
</html>
